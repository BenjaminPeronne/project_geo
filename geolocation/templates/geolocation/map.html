<!DOCTYPE html>
<html>

<head>
    <title>Carte des Étudiants</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        #map {
            width: 70%;
            height: 600px;
            float: left;
        }

        #student-list {
            width: 30%;
            height: 600px;
            overflow-y: scroll;
            float: left;
        }

        .student-item {
            padding: 10px;
            border-bottom: 1px solid #ccc;
            cursor: pointer;
        }

        .student-item:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>

<body>
    <div id="student-list"></div>
    <div id="map"></div>
    <script>
        var map = L.map('map').setView([16.265, -61.550], 10); // Initialiser la carte sur la Guadeloupe
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap'
        }).addTo(map);

        fetch('/geo/etudiants/')
            .then(response => response.json())
            .then(data => {
                console.log("Données des étudiants reçues :", data);
                const studentList = document.getElementById('student-list');
                data.forEach(etudiant => {
                    if (etudiant.latitude && etudiant.longitude) {
                        // Ajouter un marqueur pour chaque étudiant
                        const marker = L.marker([etudiant.latitude, etudiant.longitude])
                            .addTo(map)
                            .bindPopup(`${etudiant.prenom} ${etudiant.nom}`);

                        // Ajouter un élément de liste cliquable
                        const studentItem = document.createElement('div');
                        studentItem.className = 'student-item';
                        studentItem.textContent =
                            `${etudiant.prenom} ${etudiant.nom}, ${etudiant.adresse}, ${etudiant.ville}, ${etudiant.code_postal}, ${etudiant.pays}`;
                        studentItem.onclick = () => {
                            map.setView([etudiant.latitude, etudiant.longitude], 15);
                            marker.openPopup();
                        };
                        studentList.appendChild(studentItem);
                    } else {
                        console.error(
                            `Étudiant ${etudiant.prenom} ${etudiant.nom} n'a pas de coordonnées géographiques.`
                        );
                    }
                });
            })
            .catch(error => {
                console.error('Erreur lors de la récupération des données des étudiants:', error);
            });
    </script>
</body>

</html>